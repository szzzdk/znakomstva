{"version":3,"file":"i18n-s.umd.js","sources":["../lib/util.js","../index.js"],"sourcesContent":["export function regExpEscape(s){\n  return String(s).replace(/[\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","import { regExpEscape } from './lib/util';\n\nexport default class I18n {\n\n  constructor(opts = {}) {\n    let { \n      locale = 'zh-CN', \n      i18nData = {},\n      log = (process.env.NODE_ENV !== 'production'),\n    } = opts;\n\n    // data\n    this._locale = locale;\n    this._i18nData = i18nData;\n    this._log = log;\n  }\n\n  // log\n  log(msg) {\n    // no log\n    if (!this._log) return;\n    // log msg\n    if (typeof this._log === 'function') {\n      this._log(msg);\n    } else if (console && console.log) {\n      console.log(msg);\n    }\n  }\n\n  // set locale data of one locale\n  setLocaleData(locale, data={}) {\n    this._i18nData[locale] = data;\n  }\n\n  // get locale data\n  getLocaleData(lc) {\n    let locale = lc || this.getLocale();\n    return this._i18nData[locale] || {};\n  }\n\n  // set the current locale\n  setLocale(locale) {\n    this._locale = locale;\n  }\n\n  // get the current locale\n  getLocale() {\n    return this._locale;\n  }\n\n  // translate keys\n  translate(key, vars={}) {\n    let locale = this._locale;\n    let data = this._i18nData[locale] || {};\n    let val = data[key];\n    let arr = key.split('.', 2);\n\n    if (!val && arr.length > 1) {\n      val = this.findDotTranslate(arr[1], data[arr[0]]);\n    }\n\n    if (!val) {\n      this.log(`Translate lost: [${locale}] => [${key}]`);\n      return val;\n    }\n\n    return this.formatString(val, vars);\n  }\n\n  __(...args) {\n    return this.translate(...args);\n  }\n\n  findDotTranslate(key, data) {\n    if (typeof data !== 'object') return null;\n\n    let val = data[key];\n    let arr = key.split('.', 2);\n\n    if (val) return val;\n\n    if (arr.length > 1) {\n      val = this.findDotTranslate(arr[1], data[arr[0]]);\n    }\n\n    return val;\n  }\n\n  // format string\n  formatString(string, vars={}) {\n    Object.keys(vars).forEach((key) => {\n      let re = new RegExp('\\\\$\\\\{' + regExpEscape(key) + '\\\\}', 'g');\n      string = string.replace(re, vars[key]);\n    });\n    return string;\n  }\n}\n"],"names":["regExpEscape","s","String","replace","I18n","opts","locale","i18nData","log","process","env","NODE_ENV","_locale","_i18nData","_log","msg","console","data","lc","getLocale","key","vars","val","arr","split","length","findDotTranslate","formatString","translate","string","Object","keys","forEach","re","RegExp"],"mappings":"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"}